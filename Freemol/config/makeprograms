#! /bin/sh
#
# This File is part of the Freemol package
# (C) 2003 Fabio Mariotti, <fabio.mariotti@scriptsforscience.org>
# Please read the full copyright statment in the COPYING file
########################################################################
# Scan directory tree to find directories to make program makefile
# Author: F.Mariotti <fabio.mariotti@unifr.ch>
# Version: 0.1 - Aug 2000
# Bugs: works only if it run in the programs directory
#       and if the dir structure is well suited
########################################################################
# $Id: makeprograms,v 1.1.1.1 2009/01/12 16:56:08 mariotti Exp $
########################################################################
#
#
# Need one argument
#
if test -z $1
then
  echo " One argument required "
  exit 1;
fi;
#dirs=`find $1 -type d -maxdepth 1 -not -name CVS -exec basename \{\} \;`
dirs=`find $1 -type d ! -name CVS -exec basename \{\} \;`
#
# echo head of the file
#
cat <<EOF
#
# Makefile for Programs
# This Makefile is autogenerated by makeprograms.sh script
# do not change it by hand
#
include ../Makeflags
#
EOF
#
hereprog=" "
for tdir in $dirs ;
do
  if test $tdir != \. -a $tdir != programs ;
  then
  hereprog="$hereprog $tdir/$tdir.exe ";
  fi;
done;
echo ".PHONY: all clean $hereprog"
echo " "
echo "   all:"$hereprog
echo "#"
echo "#"
for tdir in $dirs ;
do
  if test $tdir != \.  -a $tdir != programs ;
  then
  echo " "$tdir/$tdir.exe" : " $tdir/Makefile
  echo "	\$(MAKE) -C $tdir"
  echo " "
  echo " $tdir/Makefile : "
  echo "	( cd $tdir && \$(FMPRMAKE) && cat Makefile.here | sed \"s/Makeflags/\.\.\/Makeflags/\" > Makefile )
"
  echo " "
  fi;
done;
#
# Clean target
#
echo "  clean:"
for tdir in $dirs ;
do
  if test $tdir != \.  -a $tdir != programs ;
  then
    echo "	(cd $tdir && rm -f *.o *.lst *.exe )"
    echo " "
  fi;
done;
#
